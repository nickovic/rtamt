/**
  MTTC - Modified Time To Collision
  Ratio between relative distance between two vehicle and their relative velocity
  Assumptions:
  (1) npc in front of ego
  (2) npc and ego in the same lane
  (3) velocity of npc lower then velocity of ego
  If assumptions are violated, TTC = +inf (no collision can occur)
  Extended TTC takes into account the effect of possible accelerations/decelerations between the two vehicles

  Ozbay, K., Yang, H., Bartin, B., & Mudigonda, S. (2008). Derivation and Validation of New
  Simulation-Based Surrogate Safety Measure. Transportation Research Record, 2083(1), 105-113.

**/

specification MTTC
  // TODO: Port the name of the variable to CSV or the otherway around
  bool back_ego_npc
  float dist_lon_ego_npc
  float velocity_ego
  float velocity_npc
  float acceleration_ego
  float acceleration_npc
  const float safe_ttc = 3.5
  bool cond
  bool cond_1
  bool cond_2
  bool cond_3
  bool cond_4
  float a1
  float a2
  float a3
  float a4
  float a5
  float delta_v
  float delta_a
  float t1
  float t2

  delta_v = abs(velocity_ego - velocity_npc)
  delta_a = abs(acceleration_ego - acceleration_npc)

  t1 = - (delta_v) - sqrt(pow(delta_v, 2) + (2*delta_a*dist_lon_ego_npc))
  t2 = - delta_v + sqrt(pow(delta_v, 2) + (2*delta_a*dist_lon_ego_npc))

  cond = back_ego_npc and (velocity_ego > velocity_npc)
  cond_1 = delta_a > 0
  cond_2 = t1 > 0
  cond_3 = t2 > 0
  cond_4 = t1 < t2

  a1 = (cond and not cond_1) -> ((dist_lon_ego_npc / (velocity_ego - velocity_npc)) >= safe_ttc)
  a2 = (cond and cond_1 and cond_2 and cond_3 and not cond_4) -> (t1 >= safe_ttc)
  a3 = (cond and cond_1 and cond_2 and cond_3 and cond_4) -> (t2 >= safe_ttc)
  a4 = (cond and cond_1 and cond_2 and not cond_3) -> (t1 >= safe_ttc)
  a5 = (cond and cond_1 and not cond_2 and cond_3) -> (t2 >= safe_ttc)

  a1 and a2 and a3 and a4 and a5



